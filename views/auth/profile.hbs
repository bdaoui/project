{{#if name}}
        <h1> Welcome {{name}}</h1>
{{else}}
        <p>This is your profile page my friend!</p>
{{/if}}

<! Google map Api >
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB64QKBW2LR_5xSwBX2voxlo0HpUEBYlzY&callback=initMap" type="text/javascript"></script>
<style type="text/css">
#map {
                        width: 500px;
                        height:500px;
}
</style>
<script type="text/javascript">
        x = navigator.geolocation;
        x.getCurrentPosition(success, failure);
        function success(position){
                var myLat = position.coords.latitude;
                var myLong = position.coords.longitude;
                var coords = new google.maps.LatLng(myLat, myLong);
                var mapOptions = {
                        zoom : 11,
                        center : coords,
                        mapTypeId : google.maps.MapTypeId.ROADMAP  
                }
                var map = new google.maps.Map(document.getElementById("map"), mapOptions);
                var marker = new google.maps.Marker({map:map, position:coords});
        }
        function failure(){}
</script>

<div id="map"></div>

<! Weather API> 
<div class="container searchContainer">
        <div class="search card card-body">
        <h1>Get The Weather For a Location</h1>
        <p class="lead">Enter Your Location</p>
        <input type="text" id="searchUser" class="form-control" placeholder="Location">
        </div>
        <br>
        <div id="profile"></div>
</div>
        <div class="container text-center mt-2">
            <button class="btn btn-primary" id="submit">Submit</button>
        </div>
<div id="content"></div>

<script type="text/javascript">
class Fetch {
  async getCurrent(input) {
    const myKey = "3f03d2cbc90ff5b3c51fd81177325951";
    const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${input}&appid=${myKey}&units=metric`);
    const data = await response.json();
    return data;
  }
}

class UI {
  constructor() {
    this.uiContainer = document.getElementById("content");
    this.city;
    this.defaultCity = "London";
  }
  populateUI(data) {
    this.uiContainer.innerHTML = `
        <div class="card mx-auto mt-5" style="width: 18rem;">
        <div class="card-body justify-content-center">
        <h5 class="card-title">${data.name}</h5>
        <h6 class="card-subtitle mb-2 text-muted">Highs of ${data.main.temp_max}¬∞C. Lows of ${data.main.temp_min}¬∞C</h6>
        <p class="card-text ">Weather conditions: ${data.weather[0].description}</p>
        <p class="card-text ">Wind speeds of: ${data.wind.speed} metres/second</p>
        <p class="card-text ">Clouds: ${data.clouds.all}%</p>
        </div>
        </div>
        `;
  }
  clearUI() {
    uiContainer.innerHTML = "";
  }
  saveToLS(data) {
    localStorage.setItem("city", JSON.stringify(data));
  }
  getFromLS() {
    if (localStorage.getItem("city" == null)) {
      return this.defaultCity;
    } else {
      this.city = JSON.parse(localStorage.getItem("city"));
    }
    return this.city;
  }
  clearLS() {
    localStorage.clear();
  }
};

const ft = new Fetch();
const ui = new UI();
const search = document.getElementById("searchUser");
const button = document.getElementById("submit");

button.addEventListener("click", () => {
  const currentVal = search.value;
  ft.getCurrent(currentVal).then((data) => {
    ui.populateUI(data);
    ui.saveToLS(data);
  });
});

window.addEventListener("DOMContentLoaded", () => {
  const dataSaved = ui.getFromLS();
  ui.populateUI(dataSaved);
});
</script>

<! Recipes Api>
<div class="container">
        <div class="row text-center">
	<h3>Feeling hungry?</h3>
	<h5>Get a random meal by clicking below</h5>
	<button class="button-primary" id="get_meal">Get Meal üçî</button>
	</div>
	<div id="meal" class="row meal"></div>
</div>

<script type="text/javascript">
const get_meal_btn = document.getElementById('get_meal');
const meal_container = document.getElementById('meal');

get_meal_btn.addEventListener('click', () => {
	fetch('https://www.themealdb.com/api/json/v1/1/random.php')
		.then(res => res.json())
		.then(res => {
		createMeal(res.meals[0]);
	});
});

const createMeal = (meal) => {
	const ingredients = [];
	for(let i=1; i<=20; i++) {
		if(meal[`strIngredient${i}`]) {
			ingredients.push(`${meal[`strIngredient${i}`]} - ${meal[`strMeasure${i}`]}`)
		} else {
		        break;
		}
	}
	
const newInnerHTML = `
<div class="row">
	<div class="columns five">
		<img src="${meal.strMealThumb}" alt="Meal Image">
		${meal.strCategory ? `<p><strong>Category:</strong> ${meal.strCategory}</p>` : ''}
		${meal.strArea ? `<p><strong>Area:</strong> ${meal.strArea}</p>` : ''}
		${meal.strTags ? `<p><strong>Tags:</strong> ${meal.strTags.split(',').join(', ')}</p>` : ''}
		<h5>Ingredients:</h5>
		<ul>
		${ingredients.map(ingredient => `<li>${ingredient}</li>`).join('')}
		</ul>
	</div>
	<div class="columns seven">
		<h4>${meal.strMeal}</h4>
		<p>${meal.strInstructions}</p>
	</div>
</div>
	${meal.strYoutube ? `
	<div class="row">
	<h5>Video Recipe</h5>
	<div class="videoWrapper">
	<iframe width="400" height="300"
	src="https://www.youtube.com/embed/${meal.strYoutube.slice(-11)}">
	</iframe>
	</div>
	</div>` : ''}
	`;
	
	meal_container.innerHTML = newInnerHTML;
}
</script>